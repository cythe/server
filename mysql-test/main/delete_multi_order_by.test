#
# MDEV-30469 Support ORDER BY and LIMIT for multi-table DELETE, index hints for single-table DELETE.
#
create table t1 (id int primary key, v int);
create table t2 (id int primary key, v int);
insert into t1 (id, v) values (4,1),(3,2),(2,3),(1,4);
insert into t2 (id, v) values (5,5),(3,2),(2,3),(6,6);
select * from t1;
select * from t2;
delete t1.*, t2.* from t1, t2 order by t1.id desc limit 3;
select * from t1;
select * from t2;

drop table if exists t1, t2;
create table t1 (id int primary key, v int);
create table t2 (id int primary key, v int);
insert into t1 (id, v) values (4,1),(3,2),(2,3),(1,4);
insert into t2 (id, v) values (5,5),(3,2),(2,3),(6,6);
select * from t1;
select * from t2;
delete t1.*, t2.* from t1, t2 order by t1.id desc;
select * from t1;
select * from t2;

drop table if exists t1, t2;
create table t1 (id int primary key, v int);
create table t2 (id int primary key, v int);
insert into t1 (id, v) values (4,1),(3,2),(2,3),(1,4);
insert into t2 (id, v) values (5,5),(3,2),(2,3),(6,6);
select * from t1;
select * from t2;
delete t1.*, t2.* from t1, t2 limit 2;
select * from t1;
select * from t2;

create table t3 (a int primary key, b text);
insert into t3 (a, b) values (1, 'hello');
delete from t3 where b = '';
drop table t3;

drop table if exists t1, t2;
create table t1 (id int primary key, v int);
create table t2 (id int primary key, v int);
insert into t1 (id, v) values (4,1),(3,2),(2,3),(1,4);
insert into t2 (id, v) values (5,5),(3,2),(2,3),(6,6);
select * from t1;
select * from t2;
delete t1.*, t2.* from t1, t2 where t1.id=t2.id;
select * from t1;
select * from t2;

drop table if exists t1;
create table t1(a INT);
insert into t1 values (1),(2),(3);
set session sql_buffer_result=1;
delete t1 from (select sum(a) a from t1) x,t1;
set session sql_buffer_result=default;
select * from t1;
drop table t1;

drop table if exists t1, t2;
create table t1(id1 smallint(5), field char(5));
create table t2(id2 smallint(5), field char(5));
insert into t1 values (1, 'a'), (2, 'aa');
insert into t2 values (1, 'b'), (2, 'bb');
update t2 inner join t1 on t1.id1=t2.id2 set t2.field=t1.field  where 0=1;
update t2, t1 set t2.field=t1.field  where t1.id1=t2.id2 and 0=1;
delete t1, t2 from t2 inner join t1 on t1.id1=t2.id2  where 0=1;
drop table t1, t2;


set session sql_buffer_result=1;
create table t1 (id int primary key, v int);
create table t2 (id int primary key, v int);
insert into t1 (id, v) values (4,1),(3,2),(2,3),(1,4);
insert into t2 (id, v) values (5,5),(3,2),(2,3),(6,6);
select * from t1;
select * from t2;
delete t1.*, t2.* from t1, t2 order by t1.id desc limit 3;
select * from t1;
select * from t2;

drop table if exists t1, t2;
create table t1 (id int primary key, v int);
create table t2 (id int primary key, v int);
insert into t1 (id, v) values (4,1),(3,2),(2,3),(1,4);
insert into t2 (id, v) values (5,5),(3,2),(2,3),(6,6);
select * from t1;
select * from t2;
delete t1.*, t2.* from t1, t2 order by t1.id desc;
select * from t1;
select * from t2;

drop table if exists t1, t2;
create table t1 (id int primary key, v int);
create table t2 (id int primary key, v int);
insert into t1 (id, v) values (4,1),(3,2),(2,3),(1,4);
insert into t2 (id, v) values (5,5),(3,2),(2,3),(6,6);
select * from t1;
select * from t2;
delete t1.*, t2.* from t1, t2 limit 2;
select * from t1;
select * from t2;

create table t3 (a int primary key, b text);
insert into t3 (a, b) values (1, 'hello');
delete from t3 where b = '';
drop table t3;

drop table if exists t1, t2;
create table t1 (id int primary key, v int);
create table t2 (id int primary key, v int);
insert into t1 (id, v) values (4,1),(3,2),(2,3),(1,4);
insert into t2 (id, v) values (5,5),(3,2),(2,3),(6,6);
select * from t1;
select * from t2;
delete t1.*, t2.* from t1, t2 where t1.id=t2.id;
select * from t1;
select * from t2;

drop table if exists t1, t2;
create table t1(id1 smallint(5), field char(5));
create table t2(id2 smallint(5), field char(5));
insert into t1 values (1, 'a'), (2, 'aa');
insert into t2 values (1, 'b'), (2, 'bb');
update t2 inner join t1 on t1.id1=t2.id2 set t2.field=t1.field  where 0=1;
update t2, t1 set t2.field=t1.field  where t1.id1=t2.id2 and 0=1;
delete t1, t2 from t2 inner join t1 on t1.id1=t2.id2  where 0=1;

drop table t1, t2;
set session sql_buffer_result=default;
